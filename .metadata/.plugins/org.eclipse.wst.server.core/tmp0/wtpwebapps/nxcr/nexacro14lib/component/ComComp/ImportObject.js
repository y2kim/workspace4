if(!nexacro.ExcelImportObject){nexacro.ExcelImportEventInfo=function(_a,_b,_c,_d){this.id=this.eventid=_b||"onsuccess";this.fromobject=_a;this.fromreferenceobject=_d;this.url=_c;};var _pExcelImportEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.ExcelImportEventInfo,nexacro.ExcelImportEventInfo);nexacro.ExcelImportEventInfo.prototype=_pExcelImportEventInfo;_pExcelImportEventInfo._type_name="ExcelImportEventInfo";delete _pExcelImportEventInfo;nexacro.ExcelImportErrorEventInfo=function(_a,_b,_c,_d,_e,_f){this.id=this.eventid=_b||"onerror";this.fromobject=_a;this.fromreferenceobject=_e;this.errortype=_c;this.errormsg=_d;this.statuscode=_f;};var _pExcelImportErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.ExcelImportErrorEventInfo);nexacro.ExcelImportErrorEventInfo.prototype=_pExcelImportErrorEventInfo;_pExcelImportErrorEventInfo._type_name="ExcelImportErrorEventInfo";delete _pExcelImportErrorEventInfo;nexacro.ExcelImportObject=function(_a,_b){this.id=this.name=_a;if(!_b){_b=this._getForm();}this.parent=_b;this._handle=null;this.importfilemode="local";this._importfilemode=0;this.commcompress="none";this._commcompress=false;this.importtype=nexacro.ImportTypes.EXCEL;this.importurl="";this._importurl="";this._uploadurl="";this._uploadservlet="";this._fileurl="";this._range="";this._applyAllsheet=false;this._responseData="";this._responseRVal=null;this._responseLVal=null;this.userawdatevalue=false;this._userawdatevalue=false;this.userawnumbervalue=true;this._userawnumbervalue=true;this._file_password=null;this._usehtmltag=true;this.usedatevalue=null;this._importSheet="";this._importStartCell=null;this._importEndCell=null;this._tran_item=null;this._file_url_ds=null;this.filedialogpath="";this.openedpath="";this.filefilter="";this.filefilterindex=0;var _c=this._unique_id=this.parent._unique_id+"_"+this.id;if(!nexacro._get_hidden_frame(_c,this._handle)){var _d=new Date().valueOf().toString();nexacro._create_hidden_frame(_c,_d,this._uploadComplete,this);nexacro._append_hidden_item(_c,"upfile",this._checkUploadFile,this,this._handle);nexacro._append_hidden_textitem(_c,"ds_command");}this.onerror=new nexacro.EventListener("onerror");this.onsuccess=new nexacro.EventListener("onsuccess");this._event_list={"onerror":1,"onsuccess":1};};var _pExcelImport=nexacro.ExcelImportObject.prototype=nexacro._createPrototype(nexacro.EventSinkObject,nexacro.ExcelImportObject);_pExcelImport._type_name="ExcelImportObject";_pExcelImport.on_created=nexacro._emptyFn;_pExcelImport.set_name=function(_a){this.id=this.name=_a;};_pExcelImport.set_importtype=function(_a){switch((_a+"").toUpperCase()){case "EXCEL":_a=0x0100;break;case "EXCEL97":_a=0x0110;break;case "EXCEL2007":_a=0x0120;break;case "HANCELL2010":_a=0x0400;break;case "HANCELL2014":_a=0x0410;break;case "CSV":_a=0x0500;break;}if(_a!=this.importtype){this.importtype=_a;}return _a;};_pExcelImport.set_importurl=function(_a){if(_a!=this.importurl){this.importurl=_a;if(_a==null){this._importurl="";}else{var _b=this._uploadservlet=nexacro._getServiceLocation(_a,this.parent._getFormBaseUrl());var _c=_b.substring(0,_b.lastIndexOf("/")+1);this._importurl=_c+"XExportImport";}}return _a;};_pExcelImport.set_commcompress=function(_a){if(_a!=this.commcompress){this.commcompress=_a;switch(_a.toString().toUpperCase()){case "COMPRESS":this._commcompress=true;break;default:this._commcompress=false;break;}}return _a;};_pExcelImport.set_importfilemode=function(_a){if(this.importfilemode!=_a){this.importfilemode=_a;this._importfilemode=_a=="server"?1:0;}return _a;};_pExcelImport.set_userawdatevalue=function(_a){if(this.userawdatevalue!=_a){this.userawdatevalue=_a;this._userawdatevalue=nexacro._toBoolean(_a);}return _a;};_pExcelImport.set_userawnumbervalue=function(_a){if(this.userawnumbervalue!=_a){this.userawnumbervalue=_a;this._userawnumbervalue=nexacro._toBoolean(_a);}return _a;};_pExcelImport.set_filedialogpath=function(_a){this.filedialogpath=_a;};_pExcelImport.set_openedpath=function(_a){};_pExcelImport.set_filefilter=function(_a){this.filefilter=_a;};_pExcelImport.set_filefilterindex=function(_a){this.filefilterindex=_a;};_pExcelImport._setImportRange=function(_a){var _b={};if(_a){if(_a.indexOf("!")>0){var _c=_a.split("!");_b["sheet"]=_c[0];var _d=_c[1];var _e;if(_d.indexOf(":")>0){_d=_d.split(":");_e=this._getExcelRowCol(_d[0]);_b["startRow"]=_e[1]?_e[1]:"";_b["startCol"]=_e[0]?_e[0]:"";_e=this._getExcelRowCol(_d[1]);_b["endRow"]=_e[1]?_e[1]:"";_b["endCol"]=_e[0]?_e[0]:"";}else{_e=this._getExcelRowCol(_d);_b["startRow"]=_e[1]?_e[1]:"";_b["startCol"]=_e[0]?_e[0]:"";_b["endRow"]="";_b["endCol"]="";}}}else{_b["sheet"]="";_b["startRow"]="";_b["startCol"]="";_b["endRow"]="";_b["endCol"]="";}this._range.push(_b);};_pExcelImport.importData=function(_a,_b,_c,_d){this._file_password=null;this._fileurl="";if(arguments.length<3){return false;}if(!this.importurl){return false;}var _e=this.importfilemode.toLowerCase();if(_e!="server"||!_a){this._importfilemode=0;}else{this._importfilemode=1;}if(_b){this._range=_b;}else{this._range="";}if(_c){this._responseLVal=[];this._responseRVal=[];var _f="";var _g=_c.split(",");if(_g.length<=1&&_g[0]){_g=_g[0].split(" ");}for(var _m=0,_n=_g.length;_m<_n;_m++ ){if(_g[_m].length){var _h=_g[_m].match(/[_A-Za-z0-9]+/g);this._responseLVal.push(_h[0]);if(_h[1]==null){_h[1]="output"+(_m+1);}this._responseRVal.push(_h[1]);_f+=" "+_h[0]+"="+_h[1];_h=null;}}this._responseData=_f;}if(_d){var _i=nexacro.replaceAll(_d," ","").split(",");for(var _m=0,_o=_i.length;_m<_o;_m++ ){var _j=_i[_m].split("=");if(_j[0]=="filepassword"){this._file_password=_j[1];_i.splice(_m,1);_d=_i.join(",");break;}}}this._user_data=_d;if(!this._importfilemode){nexacro._change_inputnode_name(this._input_node,"upfile");nexacro._findclick(this._unique_id,"upfile",this,this._handle,this.filedialogpath,this.filefilter,this.filefilterindex);}else{nexacro._change_inputnode_name(this._input_node,"");if(this._checkFileName(_a)){this._fileurl=_a;this._requestImport(_a);}else{var _k="the file extension is wrong";var _l=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",_k,this, -1);this.on_fire_onerror(this,_l);return false;}}return true;};_pExcelImport.destroy=function(){var _a=this._unique_id;this._responseLVal=[];this._responseRVal=[];this._range="";if(this._load_manager){this._load_manager.destroy();delete this._load_manager;this._load_manager=null;}if(this._file_url_ds){this._file_url_ds.clear();this._file_url_ds.destroy();delete this._file_url_ds;this._file_url_ds=null;}if(this._ds_command){this._ds_command.clear();this._ds_command.destroy();}nexacro._remove_hidden_item(_a,"upfile",this._handle);nexacro._remove_hidden_item(_a,"ds_command",this._handle);nexacro._destroy_hidden_frame(_a,this,this._handle);delete this._ds_command;this._ds_command=null;delete this.onerror;this.onerror=null;delete this.onsuccess;this.onsuccess=null;if(this.parent){this.parent.removeChild(this.id);}this._handle=null;this.parent=null;return true;};_pExcelImport.on_fire_onerror=function(_a,_b){this._setWaitCursor(false);var _c=this.onerror;if(_c&&_c._has_handlers){_c._fireEvent(this,_b);}};_pExcelImport.on_fire_onsuccess=function(_a,_b){this._setWaitCursor(false);var _c=this.onsuccess;if(_c&&_c._has_handlers){_c._fireEvent(this,_b);}};_pExcelImport._getExcelRowCol=function(_a){var _b=_a.length;var _c=[];for(var _d=0;_d<_b;_d++ ){if(!isNaN(_a[_d])){_c.push(_a.substring(0,_d));_c.push(_a.substring(_d));break;}}return _c;};_pExcelImport._transaction=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){this._load_manager=new nexacro.LoadManager(this);var _j=nexacro._getServiceObject(_b,true);this._load_manager.loadDataModule(_b,_a,_c,_d,_e,_f,_g,_h,_i,_j);};_pExcelImport._getDataset=function(_a){var _b=this.parent;if(!_b){_b=this._getForm();}var _c=this._responseRVal;var _d=_c.length;for(var _e=0;_e<_d;_e++ ){if(_c[_e]==_a){return _b[this._responseLVal[_e]];}}return null;};_pExcelImport._waitCursor=nexacro._emptyFn;_pExcelImport._setParamter=nexacro._emptyFn;_pExcelImport._getDatasetObject=function(_a){var _b=this[_a];if(_b==null&&this.parent&&this.parent!=application){_b=this.parent._getDatasetObject(_a);}if(_b==null){_b=application[_a];}return _b;};_pExcelImport._getForm=function(){var _a=null;var _b=application.mainframe;if(_b){var _c=_b.getActiveFrame();while(_c&&!_c.form){if(!_c.getActiveFrame){return null;}_c=_c.getActiveFrame();}_a=_c.form;}return _a;};_pExcelImport._isPopupFrame=function(){return false;};_pExcelImport._makeImportFormat=function(){var _a="<Import>";_a+="<Sheets>";var _b=this._range;if(_b.indexOf(",")<0){_b=nexacro.replaceAll(_b,"][",",");}_b=_b.split(",");var _c="";for(var _p=0,_q=_b.length;_p<_q;_p++ ){_b[_p]=nexacro.replaceAll(_b[_p],"[","");_b[_p]=nexacro.replaceAll(_b[_p],"]","");_a+="<Sheet ";if(_b[_p].indexOf("=")<0){var _d=_b[_p];if(_d.indexOf("!")>0){var _e=_d.split("!");if(_e[1].indexOf(":")>0){var _f=_e[0];var _d=_e[1].split(":");var _g=_d[0].match(/[0-9]+/);var _h=_d[0].match(/[A-Z]+/);var _i= +_g+1;var _j=_d[1].match(/[0-9]+/);var _k=_d[1].match(/[A-Z]+/);_a+='command=\"getsheetdata\" output=\"'+this._responseRVal+'\" head=\"'+_f+'!'+_h+_g+':'+_k+_g+'\" body=\"'+_f+'!'+_h+( +_g+1)+':'+_k+_j+'\" />';}else{_a+='command=\"getsheetdata\" output=\"'+this._responseRVal+'\" Body=\"'+_b[_p]+'\" />';}}else{_a+='command=\"getsheetdata\" output=\"'+this._responseRVal+'\" Body=\"'+_b[_p]+'\" />';}}else{_c=_b[_p].split(";");var _l=1;var _m=false;var _n="";for(var _r=0,_s=_c.length;_r<_s;_r++ ){if(!_c[_r].length){continue;}_n=_c[_r].split("=");var _o=_n[0].toLowerCase();if(_o!="command"){if(_r==0){_a+='command=\"getsheetdata\" ';}if(_o=="output"){_m=true;}}_a+=_o+"=\""+_n[1]+"\" ";}if(!_m){_a+='output=\"output'+_l+'\" ';_l++ ;}_a+="/>";}}_a+="</Sheets>";_a+="</Import>";return _a;};_pExcelImport._requestImport=function(_a){var _b=new Dataset("COMMAND");this._ds_command=_b;_b.addColumn("command","String",32);_b.addColumn("type","int",32);_b.addColumn("url","String",256);_b.addColumn("format","String",256);_b.addColumn("filemode","String",256);_b.addColumn("password","String",256);_b.addColumn("rawdatevalue","String",256);_b.addColumn("rawnumbervalue","String",256);_b.addColumn("usehtmltag","String",256);_b.addRow();_b.setColumn(0,"command","import");_b.setColumn(0,"type",this._importType);_b.setColumn(0,"url",encodeURIComponent(_a));_b.setColumn(0,"format",this._makeImportFormat());_b.setColumn(0,"filemode",this._importfilemode?"server":"local");_b.setColumn(0,"password",this._file_password);_b.setColumn(0,"rawdatevalue",this._userawdatevalue);_b.setColumn(0,"rawnumbervalue",this._userawnumbervalue);_b.setColumn(0,"usehtmltag",this._usehtmltag);if(this._ds_response){this._ds_response.clear();this._ds_response.destroy();delete this._ds_response;}var _c=this._responseLVal;for(var _i=0,_j=_c.length;_i<_j;_i++ ){var _d=this.parent[_c[_i]];if(_d){}else{var _e="Dataset is null";var _f=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",_e,this, -2011);this.on_fire_onerror(this,_f);return;}_d=null;}this._file_url_ds=new Dataset("_file_url_ds",this);this._tran_item=new nexacro.TransactionItem(this._importurl,this,this.id,"COMMAND=_ds_command",this._responseData+", _file_url_ds=IMPORTFILES",this._user_data,0,true);var _g=this._tran_item;var _h=_g._sendData;nexacro._setImportCommand(this._unique_id,"ds_command",this,this._handle,_h);nexacro._submit(this._unique_id,this._uploadservlet,this._handle,_h,_a);delete _b;delete _g;};if(nexacro.Browser=="Runtime"){_pExcelImport._uploadComplete=function(_a,_b,_c,_d,_e,_f){var _g,_h,_i,_j=this._unique_id,_k= -1,_l="",_m=null;if(_a<0){application._onHttpSystemError(this,true,this,_d,_c,_e,_c,null);var _n=nexacro._GetSystemErrorMsg(this,_d);_g=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",_n,this,9901);this.on_fire_onerror(this,_g);}else{if(_b){if(_b.indexOf("<noscript>")>=0){_b=_b.substr(_b.indexOf("<noscript>")+10);_b=_b.substr(0,_b.indexOf("</noscript>"));}_m=this._tran_item._deserializeData(_b);_h=_m[0];if(_h){_k=_h[0];_l=_h[1];}}this._tran_item=null;if(_k<0){_g=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",_l,this,9901);this.on_fire_onerror(this,_g);}else{_i=this._fileurl=this._file_url_ds?this._file_url_ds.getColumn(0,3):null;this._file_url_ds=null;var _g=new nexacro.ExcelImportEventInfo(this,"onsuccess",_i,this);this.on_fire_onsuccess(this,_g);}}nexacro._remove_hidden_item(_j,"upfile",this._handle);nexacro._append_hidden_item(_j,"upfile",this._checkUploadFile,this,this._handle);};}else{_pExcelImport._uploadComplete=function(){var _a,_b,_c,_d,_e= -1,_f="",_g=null,_h=this._unique_id;try{var _i=nexacro._getXMLDocument(_h);_a=_i.URL?_i.URL:_i.url;if(_a=="about:blank"){return;}var _j=nexacro._getDataFromDOM(_i);if(!_j||_j.length<=0){var _k=_i.childNodes[0];if(_k){if(nexacro.Browser=="IE"&&nexacro.BrowserVersion<9){_j=_k.innerHTML;}else{_j=_i.head.innerText;}}}if(_j.indexOf("<noscript>")>=0){_j=_j.substr(_j.indexOf("<noscript>")+10);_j=_j.substr(0,_j.indexOf("</noscript>"));}if(_j.indexOf("&amp")>=0){_j=nexacro.replaceAll(_j,"&amp;","&");}_g=this._tran_item._deserializeData(_j);if(this._tran_item){this._tran_item.context=null;this._tran_item.inputDatasets=null;this._tran_item.outputDatasets=null;delete this._tran_item;this._tran_item=null;}_b=_g[0];if(_b){_e=_b[0];_f=_b[1];}if(_e<0){_c=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",_f,this,9901);this.on_fire_onerror(this,_c);}else{_d=this._fileurl=this._file_url_ds?this._file_url_ds.getColumn(0,3):null;this._file_url_ds.clear();this._file_url_ds.destroy();delete this._file_url_ds;this._file_url_ds=null;_c=new nexacro.ExcelImportEventInfo(this,"onsuccess",_d,this);this.on_fire_onsuccess(this,_c);_c=null;}}catch(e){_c=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError","failed to get",this,9901);this.on_fire_onerror(this,_c);}nexacro._remove_hidden_item(_h,"upfile",this._handle);nexacro._append_hidden_item(_h,"upfile",this._checkUploadFile,this,this._handle);_j=null;};}_pExcelImport._checkFileName=function(_a){if(_a==null){return false;}var _b=false;var _c="";var _d=_a.lastIndexOf("\\");var _e=_a.substring(_d+1);var _f=_e.split(".");var _g=_f.length;if(_g>1){_c=_f[_g-1];switch(_c.toLowerCase()){case "xls":_b=true;this._importType=nexacro.ImportTypes.EXCEL97;break;case "xlsx":_b=true;this._importType=nexacro.ImportTypes.EXCEL2007;break;case "cell":_b=true;this._importType=nexacro.ImportTypes.HANCELL;break;case "csv":_b=true;this._importType=nexacro.ImportTypes.CSV;break;default:if(this._importfilemode){_b=true;this._importType=this.importtype;}break;}}else{if(this._importfilemode){_b=true;this._importType=this.importtype;}}return _b;};_pExcelImport._checkUploadFile=function(_a){this._setWaitCursor(true);var _b=_a.lastIndexOf("\\");if(_b>0){this.openedpath=_a.substring(0,_b+1);}if(this._checkFileName(_a)){this._requestImport(_a);}else{var _c="the file extension is wrong";var _d=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",_c,this, -1);this.on_fire_onerror(this,_d);}};_pExcelImport._setWaitCursor=function(_a){var _b=this.parent;if(!_b){_b=this._getForm();}_b._waitCursor(_a);};_pExcelImport._getWindow=function(){var _a=this.parent;if(_a._is_form){return _a._getWindow();}return null;};_pExcelImport._getWindowHandle=function(){var _a=this.parent;if(_a._is_form){return _a._getWindowHandle();}return null;};_pExcelImport._changeFiles=nexacro._emptyFn;delete _pExcelImport;}